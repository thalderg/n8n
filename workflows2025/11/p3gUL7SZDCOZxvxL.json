{
  "": "",
  "active": false,
  "connections": {
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Insert Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Embedding 3-small1": {
      "ai_embedding": [
        [
          {
            "node": "Insert Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Retrieve Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Retrieve Supabase Vector Store": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "GPT-4.1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Insert Supabase Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-22T13:46:16.074Z",
  "id": "p3gUL7SZDCOZxvxL",
  "isArchived": false,
  "meta": null,
  "name": "XRAG",
  "nodes": [
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.tweet_text }}",
        "textSplittingMode": "custom",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "tweet_id",
                "value": "={{ $json.tweet_id }}"
              },
              {
                "name": "date_collected",
                "value": "={{ $json.date_collected }}"
              },
              {
                "name": "tweet_url",
                "value": "={{ $json.tweet_url }}"
              },
              {
                "name": "author_username",
                "value": "={{ $json.author_username }}"
              },
              {
                "name": "author_followers",
                "value": "={{ $json.author_followers }}"
              },
              {
                "name": "like_count",
                "value": "={{ $json.like_count }}"
              },
              {
                "name": "retweet_count",
                "value": "={{ $json.retweet_count }}"
              },
              {
                "name": "bookmark_count",
                "value": "={{ $json.bookmark_count }}"
              },
              {
                "name": "view_count",
                "value": "={{ $json.view_count }}"
              },
              {
                "name": "quote_count",
                "value": "={{ $json.quote_count }}"
              },
              {
                "name": "conversation_id",
                "value": "={{ $json.conversation_id }}"
              },
              {
                "name": "has_media",
                "value": "={{ $json.has_media }}"
              },
              {
                "name": "media_type",
                "value": "={{ $json.media_type }}"
              },
              {
                "name": "media_urls",
                "value": "={{ $json.media_urls }}"
              },
              {
                "name": "external_links",
                "value": "={{ $json.external_links }}"
              },
              {
                "name": "topic",
                "value": "={{ $json.topic }}"
              },
              {
                "name": "engagement_score",
                "value": "={{ $json.engagement_score }}"
              },
              {
                "name": "days_old",
                "value": "={{ $json.days_old }}"
              },
              {
                "name": "freshness_multiplier",
                "value": "={{ $json.freshness_multiplier }}"
              },
              {
                "name": "base_score",
                "value": "={{ $json.base_score }}"
              },
              {
                "name": "engagement_rate",
                "value": "={{ $json.engagement_rate }}"
              },
              {
                "name": "bookmark_rate",
                "value": "={{ $json.bookmark_rate }}"
              },
              {
                "name": "amplification_rate",
                "value": "={{ $json.engagement_rate }}"
              },
              {
                "name": "thread_indicator",
                "value": "={{ $json.thread_indicator }}"
              },
              {
                "name": "content_type",
                "value": "={{ $json.content_type }}"
              },
              {
                "name": "call_to_action",
                "value": "={{ $json.call_to_action }}"
              },
              {
                "name": "viral_status",
                "value": "={{ $json.viral_status }}"
              },
              {
                "name": "engagement_class",
                "value": "={{ $json.engagement_class }}"
              },
              {
                "name": "bookmark_class",
                "value": "={{ $json.bookmark_class }}"
              },
              {
                "name": "amplification_class",
                "value": "={{ $json.amplification_class }}"
              },
              {
                "name": "overall_preformance",
                "value": "={{ $json.overall_performance }}"
              },
              {
                "name": "main_topic",
                "value": "={{ $(\"Execute Workflow Trigger\").item.json.mainTopic }}"
              },
              {
                "name": "createdAt",
                "value": "={{ $json.created_at }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        432,
        -320
      ],
      "id": "162a0d18-8485-4e25-bb50-108e2345135c",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "chunkOverlap": 200
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        304,
        -192
      ],
      "id": "adca69ff-5daf-4f2c-9409-db6b04a81c91",
      "name": "Character Text Splitter"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        32,
        -192
      ],
      "id": "e4e4ec58-0d46-471e-a2b8-c4072ce0a1aa",
      "name": "Embedding 3-small1",
      "credentials": {
        "openAiApi": {
          "id": "fcIDL6mBCr4eAnxg",
          "name": "OpenAi voice to text"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "twitterdata",
          "mode": "list",
          "cachedResultName": "twitterdata"
        },
        "options": {
          "queryName": "match_twitterdata"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        352,
        -480
      ],
      "id": "aaf38a4a-38a0-45eb-bdc6-5180d9b056ab",
      "name": "Insert Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "AJSgyS6o6Iogt0OW",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "=Twitter/X engagement vector store with tweet content, metrics, and metadata across multiple accounts.\n\nSTRUCTURE: {pageContent: \"text\", metadata: {...}}\n\nMETADATA FIELDS (all ALWAYS available):\n\nIdentity: author_username, tweet_url, tweet_id\nEngagement: like_count, retweet_count, bookmark_count, view_count, engagement_rate, engagement_class (poor/average/good/excellent), viral_status (low/medium/high)\nTime: days_old (age in days), freshness_multiplier, date_collected\nContent: content_type, thread_indicator, has_media, call_to_action\nOther: conversation_id, author_followers, overall_preformance\n\nCITATION (MANDATORY):\n[@{metadata.author_username}]({metadata.tweet_url})\n\"{excerpt}\"\nMetrics: {engagement_class} | {engagement_rate}% | {like_count} likes | {days_old}d old\n\nNever say metadata \"not available\" - extract from metadata object.\n\nUSE FOR: Performance analysis, viral pattern identification, narrative tracking, content benchmarking, strategic insights.\n\nEXAMPLES:\n• \"Tweets with engagement_class='excellent' from past week\"\n• \"High viral_status content about [topic]\"\n• \"Compare bookmark_rate by content_type\"",
        "tableName": {
          "__rl": true,
          "value": "twitterdata",
          "mode": "list",
          "cachedResultName": "twitterdata"
        },
        "topK": 10,
        "options": {
          "queryName": "match_twitterdata"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -304,
        -16
      ],
      "id": "f64a0ab2-97a8-4882-86ca-a5dab6e183ec",
      "name": "Retrieve Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "AJSgyS6o6Iogt0OW",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -848,
        -480
      ],
      "id": "28b15598-0db6-4c2b-b265-3bec7d29c1ca",
      "name": "When chat message received",
      "webhookId": "dbc84075-4e9f-4466-a5cb-cef46c130f67",
      "disabled": true
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=<AgentInstructions>\n\n    <Role>\n        You are an Engagement Intelligence Expert - a social media strategist who analyzes tweet data to uncover trends, narrative evolution, and growth opportunities. You combine data-driven insights with creative, cross-disciplinary thinking. you take inspiration from user inputs and ideas in chats to craft amazing output with novel ideas based on the data you have stored and retireved from your vector store\n\n    <CorePrinciples>\n        \n        <Principle name=\"Evidence-Based\">\n            Always ground insights in actual data. State confidence levels explicitly:\n            - HIGH: 10+ tweets across multiple days OR exceptional engagement patterns\n            - MEDIUM: Fewer tweets but clear signals\n            - LOW/SPECULATIVE: Interesting but limited data\n            \n            If you lack sufficient evidence, say so. Never hallucinate connections.\n        </Principle>\n\n        <Principle name=\"Strategic Focus\">\n            Prioritize actionable intelligence over description. Look for:\n            • Narrative evolution (how ideas develop over time)\n            • Engagement pattern shifts (what's gaining momentum)\n            • Contrarian signals (high-performing opposing views)\n            • Content gaps (high interest, low coverage)\n            • Cross-domain connections (when genuinely insightful)\n        </Principle>\n\n        <Principle name=\"Clarity Through Structure\">\n            Every response should include:\n            1. What you searched for and why\n            2. Key connections/patterns with supporting evidence\n            3. Relevant tweet URLs (organized logically)\n            4. 3-5 strategic recommendations (choose what matters most)\n            \n            Keep it tight. Users want insights, not walls of text.\n        </Principle>\n\n        <Principle name=\"Recency Awareness\">\n            Weight recent content heavily unless analyzing historical trends. Use metadata: `days_old`, `freshness_multiplier`, `engagement_rate`, `viral_status`, `engagement_class`, `bookmark_class`, `amplification_class`.\n            \n            For \"new metas,\" compare current vs historical baselines with specific metrics.\n        </Principle>\n\n        <Principle name=\"Authentic Growth\">\n            Recommend strategies that fit the user's genuine expertise and interests. No gaming tactics - focus on amplifying what already works. Growth through authenticity, not manipulation.\n        </Principle>\n\n    </CorePrinciples>\n\n  <VectorStoreUsagePolicy>\n      CRITICAL: When to Query the Vector Store\n      \n      YOU MUST query the vector store tool for EVERY question that requires:\n      • Pattern analysis across multiple tweets\n      • Trend identification or comparison\n      • Performance analysis or benchmarking\n      • Finding examples of specific content types\n      • Strategic recommendations based on engagement data\n      • Any question with: \"analyze,\" \"compare,\" \"identify,\" \"find,\" \"what performs,\" \"show me\"\n      \n      Conversation memory is ONLY for:\n      • Recalling specific tweets already discussed in THIS conversation\n      • Understanding user preferences and context\n      • Clarifying previous responses\n      \n      DO NOT use conversation memory to:\n      ❌ Answer new analytical questions\n      ❌ Identify patterns (need fresh comprehensive data)\n      ❌ Make performance comparisons (need full dataset)\n      ❌ Generate strategic recommendations (need current evidence)\n      \n      If you find yourself thinking \"I remember some examples from earlier,\" STOP.\n      Query the vector store instead. Fresh data = reliable insights.\n      \n      Workflow for analytical questions:\n      1. Identify what data is needed\n      2. Query vector store with specific search terms\n      3. Retrieve 10-20+ relevant tweets\n      4. Analyze fresh results\n      5. State confidence based on sample size\n      \n      Never say \"based on earlier examples\" in analytical responses.\n      Always say \"based on [X tweets] retrieved from vector store.\"\n  </VectorStoreUsagePolicy>\n\n    <KeyGuidelines>\n        \n        • **Query Strategy**: Make multiple searches from different angles for comprehensive coverage. State what you're looking for upfront.\n        \n        • **Time Bounds**: Respect user-specified timeframes strictly. Default to emphasizing last 7-14 days with historical context when no constraint given.\n        \n        • **Citations**: Provide tweet URLs cleanly. Paraphrase or excerpt key insights - never reproduce full tweets. Always attribute with username and metrics.\n        \n        • **Thread Handling**: Analyze threads as cohesive narratives. Link to parent tweet but reference key thread insights.\n        \n        • **Engagement Metrics**: Interpret bookmark_class, amplification_class, and engagement_rate as primary performance indicators. High bookmarks = valuable reference content.\n        \n        • **Scale Handling**: Query scope ranges from 10 to 1000+ tweets. For large datasets, summarize patterns and highlight representative examples.\n        \n        • **Tone**: Balanced and actionable. Assume solid foundational knowledge unless user requests otherwise. Focus on intelligence over tutorials.\n        \n        • **Creative License**: You can suggest unconventional angles and cross-domain connections, BUT clearly distinguish data-backed insights from speculative opportunities.\n\n    </KeyGuidelines>\n\n    <StrategicOutputs>\n        Choose the most relevant recommendations based on your analysis. Options include:\n        \n        • \"This is a new meta\" (explain momentum indicators with confidence level)\n        • \"Strong article/content opportunity\" (identify gaps, provide specific angles)\n        • \"Contrarian play\" (underexplored perspectives with engagement potential)\n        • \"Recommended reply angles\" (provide 2-3 approaches with examples)\n        • \"Original tweet ideas\" (provide 2-3 angles with examples)\n        • \"Engagement optimization tip\" (based on performance data)\n        • \"CTA/format recommendations\" (backed by content_type and call_to_action analysis)\n        • Any other insight you identify\n        \n        Surprise the user with creativity while staying grounded in evidence.\n    </StrategicOutputs>\n\n    <FutureCapabilities>\n        When user's own tweets/bookmarks become available:\n        • Treat bookmarks as high-priority interest signals\n        • Benchmark their performance against successful patterns\n        • Provide specific improvement recommendations\n        • Analyze their authentic voice and suggest aligned content\n    </FutureCapabilities>\n\n</AgentInstructions>",
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -624,
        -464
      ],
      "id": "d0bfd387-a904-4d5c-aa51-49f876550367",
      "name": "AI Agent"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        -480,
        -176
      ],
      "id": "48d3cecd-7345-4995-9ef3-28c7a3d15173",
      "name": "Think"
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -624,
        -176
      ],
      "id": "003d4b88-b843-4bbb-aa06-ac1f9161bceb",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "qmFOJkAksFNgWfUk",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -768,
        -176
      ],
      "id": "4b079a4e-42d2-4236-a56f-2b22601a3465",
      "name": "GPT-4.1",
      "credentials": {
        "openAiApi": {
          "id": "fcIDL6mBCr4eAnxg",
          "name": "OpenAi voice to text"
        }
      }
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        48,
        -480
      ],
      "id": "81ddef2b-d3a4-44e5-b946-b451f22b924b",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "content": "## RAG Engament Agent\n### To be modified",
        "height": 560,
        "width": 848,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -960,
        -592
      ],
      "id": "a43cec14-584c-4bd7-9daa-8bd423f48d85",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Supabase RAG Loader\n### To be modified",
        "height": 560,
        "width": 848,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -96,
        -592
      ],
      "id": "c5f0c6ca-1352-4221-8c88-7aad97beb93e",
      "name": "Sticky Note1"
    }
  ],
  "pinData": {},
  "repo_name": "n8n",
  "repo_owner": "thalderg",
  "repo_path": "workflows",
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-11-22T13:46:16.081Z",
      "updatedAt": "2025-11-22T13:46:16.081Z",
      "role": "workflow:owner",
      "workflowId": "p3gUL7SZDCOZxvxL",
      "projectId": "rwZmgF8pMPgWdXwq"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-22T13:51:57.000Z",
  "versionId": "508f025d-5baf-4f16-a043-a29ab18e778c"
}